   Notes on updating Topmed source tree in production

on my machine
git pull

if removed something, do
git rm file
git commit -m "why did you remove this"

Commit anything else you need do in GitHub/Desktop
Sync to master

If you must merge code, be sure to sign into github as tgliedt, then the merge button will appear

#   PW=LsdI2HafPS

ssh topmed
cd ~/dev
#   If starting all over
  rm -rf ~/dev/monitor-topmed /net/topmed/working/build /tmp/monitor-topmed /var/tmp/monitor-topmed /var/tmp/monitor
  git clone git@github.com:statgen/monitor-topmed.git   # Prompt for ssh pw above

#   Normal processing
build_dir=/tmp/monitor-topmed                          # test
build_dir=/net/topmed/working/build/monitor-topmed     # prod
#   Not needed if starting over  Only use for PROD   Prompt for ssh pw above 
if [ "$build_dir" != "/tmp/monitor-topmed" ]; then
  b=`dirname $build_dir`
  mkdir -p $b
  chmod -R 0775 $b
  chgrp topmed-dev $b
fi

#   Build locally.  If database changes were made, update schema
  rex schema
  git commit -m "DB changes" -a
  git push              # Prompt for ssh pw above
Â  #   Update database information.  Check if schemas are correct
  ls -l $builddir/topmed-monitor/lib/perl5/Topmed/DB/Schema/Result

#   test build locally      # install_dir=/var/tmp/monitor-topmed  build_dir=/tmp/monitor-topmed
cd ~/dev/monitor-topmed
rex -E test build           # Result is in $build_dir
  
#   Normal build locally    # install_dir=/var/tmp/monitor  build_dir=/net/topmed/working/build/monitor-topmed 
cd ~/dev/monitor-topmed
rex -E prod build           # Result is in $build_dir

#   Install in production place with a different schema?
cd ~/dev/monitor-topmed
rex -E prod install         # installed in /var/tmp/monitor



#   Copy prod-install to production to be used
rsync -av /var/tmp/monitor/* /usr/cluster/topmed

