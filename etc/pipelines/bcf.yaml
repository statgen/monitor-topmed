name: bcf_generation
description: Generate BCF file
inputParameters:
  - name: INPUT_FILE
    localCopy:
      disk: boot
      path: input.cram
  - name: FASTA_PATH
    defaultValue: /usr/local/share/ref/hs38DH.fa
  - name: NWDID
outputParameters:
  - name: OUTPUT_FILE
    localCopy:
      disk: boot
      path: output.bcf
resources:
  minimumCpuCores: 1
  minimumRamGb: 12
  bootDiskSizeGb: 250
  zones:
    - us-central1-a
    - us-central1-b
    - us-central1-c
    - us-central1-f
docker:
  imageName: us.gcr.io/topmed-1366/vt-discover
  cmd: |
    set -o pipefail
    samtools view -T ${FASTA_PATH} -uh ${INPUT_FILE} \
      | bam clipOverlap --poolSize 100000000 --in -.ubam --out -.ubam \
      | vt discover2 -z -q 20 -b + -r ${FASTA_PATH} -s ${NWDID} -o ${OUTPUT_FILE}
